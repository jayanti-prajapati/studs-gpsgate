<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <link rel="stylesheet" type="text/css" href="styles.css">
  <title>Hackathon</title>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>

  <!-- Include core bootstrap -->
  <script type="text/javascript" src="http://studs.gpsgate.com/Services/Core.ashx?xss2=true&deps=true"></script>
  
  <!-- Google maps API -->
  <!--https://developers.google.com/maps/documentation/javascript/tutorial -->
  <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?libraries=geometry&sensor=true&key=AIzaSyAfORwBikitB2iR46uR-J-6K2msh15sxCQ"></script>
  
  <script>
    // Include session handling (login/logout) + jQuery
    goog.require('GpsGate.Session');

    // knockout (http://http://knockoutjs.com/)
    // goog.require('ko');
  </script>

  <script>
    // Include hackathon web service
    GpsGate.require('GpsGate.Server.Hackathon');
  </script>

  <script>

    function doLogin() {
      var appId = 5;
      var username = 'team8';
      var password = '1234';
      
      return GpsGate.Session.login(username, password, { appId: appId }).addCallbacks(
          function(result) {
            console.log('Login OK');
            setTimeout(mainProgram, 0); // use timeout "trick" to get out of the deferred callback chain scope
          },
          function(error) {
            console.error("that's a bummer!")
          }
        );
    }

    function mainProgram() {
      // do something
      console.log('app.main');

      // Get some users
      GpsGate.Server.Hackathon.GetNearbyLocations().addCallbacks(
        function(response) {
          for(var i = 0; i < response.length; i++){
            var location = response[i];
            console.log(location);
            console.log(ComputeLatLng(0, 0, location.heading, location.distance));
          }
        }, 
        function(error){}
      );

      GpsGate.Server.Hackathon.GetUpdatedUsers().addCallbacks(
        function(response) {
          var ul = jQuery('#users');
          for (var i = 0; i < response.users.length; i++) {
            ul.append('<li>' + response.users[i].name + '</li>');
          }
        },
        function(error) { }
      );
    }

    jQuery(document).ready(doLogin);
  </script>

  <script type="text/javascript" src="script.js"></script>
</head>
<body>
  <div>
    supergrupp 8
    <ul id="users">
    </ul>
  </div>
  <div id="map-canvas" />
</body>
</html>
